$(document).ready(function(){
    dataHoje();
    mascaras();
    validacao();

    $('#valor').focus();

    $( "#btn_calcular" ).click(function() {
        calcular();
        calcularData();
        return false;
    });

    $( "#btn_limpar" ).click(function() {
        limpar();
    });
});



function dataHoje(){
    // Obtém a data/hora atual
var data = new Date();

// Guarda cada pedaço em uma variável
var dia     = data.getDate();           // 1-31
var dia_sem = data.getDay();            // 0-6 (zero=domingo)
var mes     = data.getMonth();          // 0-11 (zero=janeiro)
var ano2    = data.getYear();           // 2 dígitos
var ano4    = data.getFullYear();       // 4 dígitos
var hora    = data.getHours();          // 0-23
var min     = data.getMinutes();        // 0-59
var seg     = data.getSeconds();        // 0-59
var mseg    = data.getMilliseconds();   // 0-999
var tz      = data.getTimezoneOffset(); // em minutos

// Formata a data e a hora (note o mês + 1)
var str_data = dia + '/' + (mes+1) + '/' + ano4;
var str_hora = hora + ':' + min + ':' + seg;

// Mostra o resultado
$('#datapgto').val(str_data);
alert(str_data)
}

function calcularData(){
    $("#datapgto").focusout(function(){
        var dtI = $("#datavcto").html().split('/');
        var dtF = $("#datapgto").val().split('/');
        dia_I = dtI[0];
        dia_F = dtF[0];
        mes_I = dtI[1];
        mes_F = dtF[1];
        ano_I = dtI[2];
        ano_F = dtF[2];
        var calculoDia = dia_F - dia_I;
        var calculoMes = mes_F - mes_I;
        var calculoAno = ano_F - ano_I;
    
        if(calculoDia < "0" || calculoMes < "0" || calculoAno < "0"){
            BackOffice.alert("A data de término não pode ser anterior a data de inicio.", "Aviso", function(){
                $("#data-termino-ausencia").val("");
                $("#data-termino-ausencia").focus();
                BackOffice.closeModal('.modal', true);
            });
        } else if (calculoDia < "0" || calculoMes >= "0" || calculoAno >= "0") {       
            $(".outros-ausencia").focus();
        } else if (calculoDia <= "0" || calculoMes >= "0" || calculoAno >= "0") {
            $(".outros-ausencia").focus();
        }
    })
}

function limpar(){
    $('#jurosDia').val('');
    $('#multa').val('');
    $('#valor').val('');
    $('#datavcto').val('');
    $('#datapgto').val('');
    $('#totalPagar').val('');
    $('#valor').focus();
}

function calcular(){
    let jurosDia   = $("#jurosDia").val();
    let multa      = $("#multa").val();
    let vcto       = $("#datavcto").val();
    let pgto       = $("#datapgto").val();
    let totalPagar = $("#totalPagar").val();
    let valor      = $("#valor").val();

    //Ex: R$ 125,00 * 10% = R$ 12,50
    let jurosPorDia = valor * jurosDia /100;

    //Ex: R$ 30,00 + R$ 125,00 = R$ 155,00
    let multaTotal  = parseFloat(multa) +parseFloat(valor);

    let totalApagar = jurosPorDia + multaTotal;

    $('#totalPagar').val(totalApagar);
    aviso();
    
}

function aviso(){  

    if( $('#jurosDia').val() == "" || null){
        $('#btn_aviso').trigger('click');
        $('#jurosDia').focus();    
        $('#btn_calcular').prop('disabled', true);    

        $('#msg').html("Digite o valor do juros que será cobrado por dia");
        setTimeout( function(){
            $('#btn_aviso').trigger('click');
            $('#btn_calcular').prop('disabled', false); 
        }, 5000);
    }

    switch (key) {
        case value:
            
            break;
    
        default:
            break;
    }
    
    
}

function mascaras(){
    $("#multa").mask("9.990,00",{reverse: true});    
    $("#valor").mask("9.990,00",{reverse: true});    
    $("#jurosDia").mask("999,00",{reverse: true});              
}

function validacao(){
    $("#formulario").validate({
        rules:{
            valor:{
                required: true
            },
            jurosDia:{
                required:true
            },
            datapgto:{
                required:true
            },
            datavcto:{
                required:true
            }
        }
    });
}